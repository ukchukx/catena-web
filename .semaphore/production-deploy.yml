version: v1.0
name: Deploy to production
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804
blocks:
  - name: Transfer
    task:
      secrets:
        - name: ssh-key
      jobs:
        - name: transfer files
          commands:
            - echo 'Deploying to production...'
            - scp -o StrictHostKeyChecking=no dist/* {run,stop}.sh Dockerfile .dockerignore docker-compose.yml ubuntu@109.237.25.250:~/apps/catena/web/

  - name: Deploy
    task:
      secrets:
        - name: ssh-key
      jobs:
        - name: deploy app
          commands:
            - ssh -o StrictHostKeyChecking=no ubuntu@109.237.25.250 'cd ~/apps/catena/web;docker build -t catena_web .;./run.sh'
